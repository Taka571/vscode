<!-- Copyright (C) Microsoft Corporation. All rights reserved. -->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />

		<!-- Disable pinch zooming -->
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
		/>

		<!-- Workbench Configuration -->
		<meta id="vscode-workbench-web-configuration" data-settings="{{WORKBENCH_WEB_CONFIGURATION}}" />

		<!-- Workarounds/Hacks (remote user data uri) -->
		<meta id="vscode-remote-user-data-uri" data-settings="" />

		<!-- Workbench Icon/Manifest/CSS -->
		<link rel="icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="manifest" href="/manifest.json" />
	</head>

	<body aria-label=""></body>

	<script>
		const staticExtensions = [
			{
				packageJSON: {
					name: 'web-api',
					description: 'Web backend for VS Code',
					version: '0.0.1',
					publisher: 'vscode',
					license: 'MIT',
					enableProposedApi: true,
					private: true,
					activationEvents: ['onFileSystem:memfs', 'onDebug'],
					main: './out/extension',
					engines: {
						vscode: '^1.25.0'
					},
					contributes: {
						configuration: {
							type: 'object',
							title: 'Test Config',
							properties: {
								'farboo.config0': {
									type: 'boolean',
									default: true
								},
								'farboo.nested.config1': {
									type: 'number',
									default: 42
								},
								'farboo.nested.config2': {
									type: 'string',
									default: 'Das Pferd frisst kein Reis.'
								},
								'farboo.config4': {
									type: 'string'
								},
								'farboo.get': {
									type: 'string',
									default: 'get-prop'
								}
							}
						},
						configurationDefaults: {
							'[abcLang]': {
								'editor.lineNumbers': 'off',
								'editor.tabSize': 2
							}
						},
						taskDefinitions: [
							{
								type: 'custombuildscript',
								required: ['flavor'],
								properties: {
									flavor: {
										type: 'string',
										description: "The build flavor. Should be either '32' or '64'."
									},
									flags: {
										type: 'array',
										description: 'Additional build flags.'
									}
								}
							}
						],
						breakpoints: [
							{
								language: 'markdown'
							}
						],
						debuggers: [
							{
								type: 'mock',
								label: 'Mock Debug',
								languages: ['markdown'],
								configurationAttributes: {
									launch: {
										required: ['program'],
										properties: {
											program: {
												type: 'string',
												description: 'Absolute path to a text file.',
												default: '${workspaceFolder}/file.md'
											},
											stopOnEntry: {
												type: 'boolean',
												description: 'Automatically stop after launch.',
												default: true
											},
											trace: {
												type: 'boolean',
												description: 'Enable logging of the Debug Adapter Protocol.',
												default: true
											}
										}
									}
								},
								initialConfigurations: [
									{
										type: 'mock',
										request: 'launch',
										name: 'Debug file.md',
										program: '${workspaceFolder}/file.md'
									}
								]
							}
						]
					},
					scripts: {
						compile: 'node ./node_modules/vscode/bin/compile -watch -p ./',
						'vscode:prepublish':
							'node ../../node_modules/gulp/bin/gulp.js --gulpfile ../../build/gulpfile.extensions.js compile-extension:vscode-api-tests ./tsconfig.json'
					},
					devDependencies: {
						'@types/mocha': '2.2.43',
						'@types/node': '^12.11.7',
						'mocha-junit-reporter': '^1.17.0',
						'mocha-multi-reporters': '^1.1.7',
						'ts-loader': '^6.2.1',
						typescript: '^3.7.4',
						vscode: '^1.1.36',
						webpack: '^4.41.5',
						'webpack-cli': '^3.3.10'
					},
					dependencies: {
						'kv-storage-polyfill': '^2.0.0'
					},
					extensionKind: ['web']
				},
				extensionLocation: {
					scheme: 'http',
					authority: 'localhost:8080',
					path: '/web-extension/web-api'
				}
			},
			{
				packageJSON: {
					name: 'theme-defaults',
					displayName: '%displayName%',
					description: '%description%',
					categories: ['Themes'],
					version: '1.0.0',
					publisher: 'vscode',
					license: 'MIT',
					engines: {
						vscode: '*'
					},
					contributes: {
						themes: [
							{
								id: 'Default Dark+',
								label: 'Dark+ (default dark)',
								uiTheme: 'vs-dark',
								path: './themes/dark_plus.json'
							},
							{
								id: 'Default Light+',
								label: 'Light+ (default light)',
								uiTheme: 'vs',
								path: './themes/light_plus.json'
							},
							{
								id: 'Visual Studio Dark',
								label: 'Dark (Visual Studio)',
								uiTheme: 'vs-dark',
								path: './themes/dark_vs.json'
							},
							{
								id: 'Visual Studio Light',
								label: 'Light (Visual Studio)',
								uiTheme: 'vs',
								path: './themes/light_vs.json'
							},
							{
								id: 'Default High Contrast',
								label: 'High Contrast',
								uiTheme: 'hc-black',
								path: './themes/hc_black.json'
							}
						],
						iconThemes: [
							{
								id: 'vs-minimal',
								label: 'Minimal (Visual Studio Code)',
								path: './fileicons/vs_minimal-icon-theme.json'
							}
						]
					},
					extensionKind: ['web']
				},
				extensionLocation: {
					scheme: 'http',
					authority: 'localhost:8080',
					path: '/static-extension/theme-defaults'
				}
			}
		];
		staticExtensions.forEach(ext => {
			ext.extensionLocation.scheme = location.protocol.replace(/\:$/, '');
			ext.extensionLocation.authority = location.host;
		});
		const configElement = document.querySelector('#vscode-workbench-web-configuration');
		configElement.setAttribute(
			'data-settings',
			JSON.stringify({
				staticExtensions,
				folderUri: { scheme: 'memfs', path: `/sample-folder` }
			})
		);
	</script>

	<!-- Startup (do not modify order of script tags!) -->
	<script>
		// NOTE: Changes to inline scripts require update of content security policy
		self.require = {
			baseUrl: `${window.location.origin}/static/out`,
			paths: {
				'vscode-textmate': `${window.location.origin}/static/remote/web/modules/vscode-textmate/release/main`,
				'onigasm-umd': `${window.location.origin}/static/remote/web/modules/onigasm-umd/release/main`,
				xterm: `${window.location.origin}/static/remote/web/modules/xterm/lib/xterm.js`,
				'xterm-addon-search': `${window.location.origin}/static/remote/web/modules/xterm-addon-search/lib/xterm-addon-search.js`,
				'xterm-addon-web-links': `${window.location.origin}/static/remote/web/modules/xterm-addon-web-links/lib/xterm-addon-web-links.js`,
				'xterm-addon-webgl': `${window.location.origin}/static/remote/web/modules/xterm-addon-webgl/lib/xterm-addon-webgl.js`,
				'semver-umd': `${window.location.origin}/static/remote/web/modules/semver-umd/lib/semver-umd.js`
			}
		};
	</script>
	<script src="./static/out/vs/loader.js"></script>
	<!-- <script>
		// NOTE: Changes to inline scripts require update of content security policy
		require(['vs/code/browser/workbench/workbench'], function() {});
	</script> -->
	<script>
		// eslint-disable
		if (location.hostname === 'localhost') {
			require(['vs/code/browser/workbench/workbench'], function() {});
		} else {
			(async () => {
				const loaderElement = document.createElement('div');
				loaderElement.innerHTML = `<div style="width:100vw;height:100vh;display:flex; background: #444; justify-content: center; align-items: center;">
				<style>
					html, body {
						margin: 0;
						padding: 0
					}
					.spinner {
						pointer-events: none;
						width: 2.5em;
						height: 2.5em;
						border: 0.4em solid transparent;
						border-color: #eee;
						border-top-color: #3E67EC;
						border-radius: 50%;
						animation: loadingspin 1s linear infinite;
					}
					@keyframes loadingspin {
						100% { transform: rotate(360deg) }
					}
				</style>
				<div >
					<div class="spinner"></div>
				</div>
			</div>`;
				document.body.appendChild(loaderElement);

				let installed = !!navigator.serviceWorker.controller;
				navigator.serviceWorker.addEventListener('controllerchange', () => {
					if (installed) {
						const modal = document.createElement('div');
						modal.innerHTML = `<div style='position: absolute; outline: 1px solid black; right: 10px; bottom: 10px; width: 350px; height: 80px'>
	<div>New version available!</div>
	<span>It will be applied from the next</span> - <button onclick="location.reload()">Reload</button>
</div>`;
						document.body.appendChild(modal);
					}
				});
				const reg = await navigator.serviceWorker.register('/sw.js');
				await navigator.serviceWorker.ready;
				installed = true;
				setInterval(() => {
					reg.update();
				}, 60 * 1000);

				require(['vs/code/browser/workbench/workbench'], function() {
					loaderElement.remove();
				});
			})();
		}
	</script>
</html>
